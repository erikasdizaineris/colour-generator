(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function l(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=l(e);fetch(e.href,s)}})();const g=document.getElementById("colorInput"),y=document.getElementById("generateBtn"),p=document.getElementById("colorPreview"),h=document.getElementById("hexCode"),k=document.getElementById("downloadBtn");document.getElementById("canvas");const b=document.getElementById("feedbackContainer"),f=document.getElementById("likeBtn"),n=document.getElementById("dislikeBtn");let i="",C="",L=0;async function w(t={}){const o=g.value.trim();if(!o)return;const{previousColor:l,mode:r,step:e}=t;y.disabled=!0,y.textContent="Generating...",r||(L=0),r!=="refine"&&(b.style.display="none",f.classList.remove("liked"),n.classList.remove("disliked"));try{const s=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,previousColor:l,mode:r,step:e||0})});if(!s.ok)throw new Error("Generation failed");let a=(await s.json()).color;l&&a===l&&(console.warn("Server returned same color. Forcing client-side shift."),a="#"+((parseInt(a.slice(1),16)+3355443)%16777215).toString(16).padStart(6,"0").toUpperCase()),C=o,i=a,p.style.backgroundColor=a,p.classList.add("active"),h.textContent=a,k.disabled=!1,g.style.borderColor=a,b.style.display="flex",f.classList.remove("liked"),n.classList.remove("disliked")}catch(s){console.warn("Backend unavailable:",s);let d=0;const a=o+(e||0);for(let u=0;u<a.length;u++)d=a.charCodeAt(u)+((d<<5)-d);let v="#";for(let u=0;u<3;u++){const B=d>>u*8&255;v+=("00"+B.toString(16)).substr(-2)}const m=v.toUpperCase();p.style.backgroundColor=m,p.classList.add("active"),h.textContent=m,i=m,k.disabled=!1,g.style.borderColor=m,b.style.display="none",f.classList.remove("liked"),n.classList.remove("disliked")}finally{y.disabled=!1,y.textContent="Generate"}}async function x(t){if(!(!C||!i))try{if(t==="dislike"){n.classList.add("disliked"),f.classList.remove("liked");const o=n.textContent;n.disabled=!0,n.textContent="...",L++,await w({previousColor:i,mode:"refine",step:L}),n.disabled=!1,n.textContent=o;return}t==="like"&&(await fetch("/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:C,color:i,rating:t})}),f.classList.add("liked"),n.classList.remove("disliked"))}catch(o){console.error("Feedback failed:",o),n.disabled=!1,n.textContent="ðŸ‘Ž"}}function E(){if(!i)return;const t=`<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000">
  <rect width="1000" height="1000" fill="${i}" />
  <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="80" fill="${I(i)}" text-anchor="middle" dy=".3em">${i}</text>
</svg>`,o=new Blob([t],{type:"image/svg+xml"}),l=URL.createObjectURL(o),r=document.createElement("a");r.download=`swatch-${i.substring(1)}.svg`,r.href=l,r.click(),URL.revokeObjectURL(l)}function I(t){t=t.replace("#","");var o=parseInt(t.substr(0,2),16),l=parseInt(t.substr(2,2),16),r=parseInt(t.substr(4,2),16),e=(o*299+l*587+r*114)/1e3;return e>=128?"black":"white"}y.addEventListener("click",w);g.addEventListener("keypress",t=>{t.key==="Enter"&&w()});k.addEventListener("click",E);f.addEventListener("click",()=>x("like"));n.addEventListener("click",()=>x("dislike"));const c=document.getElementById("toast");h.addEventListener("click",()=>{i&&navigator.clipboard.writeText(i).then(()=>{c.classList.add("show"),setTimeout(()=>{c.classList.remove("show")},2e3)}).catch(t=>{console.error("Failed to copy class",t),c.textContent="Failed to copy",c.style.backgroundColor="var(--error-color)",c.classList.add("show"),setTimeout(()=>{c.classList.remove("show"),setTimeout(()=>{c.textContent="Copied to clipboard!",c.style.backgroundColor="var(--success-color)"},300)},2e3)})});
