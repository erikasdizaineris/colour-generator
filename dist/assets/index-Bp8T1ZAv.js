(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}})();const h=document.getElementById("colorInput"),y=document.getElementById("generateBtn"),g=document.getElementById("colorPreview"),C=document.getElementById("hexCode"),L=document.getElementById("downloadBtn");document.getElementById("canvas");const v=document.getElementById("feedbackContainer"),p=document.getElementById("likeBtn"),i=document.getElementById("dislikeBtn"),f=document.getElementById("toast"),O="",b=O.replace(/\/+$/,""),S=b?`${b}/api/generate`:"/api/generate",T=b?`${b}/api/feedback`:"/api/feedback";let c="",x="",w=null;function $(e){return e?(e.startsWith("#"),e):"#FFFFFF"}let B=0;async function E(e={}){const t=h.value.trim();if(!t)return;const{previousColor:l,mode:s,step:n}=e;y.disabled=!0,y.textContent="Generating...",s||(B=0),s!=="refine"&&(v.style.display="none",p.classList.remove("liked"),i.classList.remove("disliked"));try{const o=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,previousColor:l,mode:s,step:n||0})});if(!o.ok)throw new Error("Generation failed");const r=await o.json();if(!r||typeof r.color!="string")throw new Error("No color in response");let a=$(r.color).toUpperCase();l&&a===l&&(console.warn("Server returned same color. Forcing client-side shift."),a="#"+((parseInt(a.slice(1),16)+3355443)%16777215).toString(16).padStart(6,"0").toUpperCase()),x=t,c=a,g.style.backgroundColor=a,g.classList.add("active"),C.textContent=a,L.disabled=!1,h.style.borderColor=a,v.style.display="flex",p.classList.remove("liked"),i.classList.remove("disliked")}catch(o){console.warn("Backend unavailable:",o);let r=0;const a=t+(n||0);for(let d=0;d<a.length;d++)r=a.charCodeAt(d)+((r<<5)-r);let m="#";for(let d=0;d<3;d++){const k=r>>d*8&255;m+=("00"+k.toString(16)).substr(-2)}const u=m.toUpperCase();g.style.backgroundColor=u,g.classList.add("active"),C.textContent=u,c=u,L.disabled=!1,h.style.borderColor=u,v.style.display="none",p.classList.remove("liked"),i.classList.remove("disliked")}finally{y.disabled=!1,y.textContent="Generate"}}async function F(e){if(!(!x||!c))try{if(e==="dislike"){i.classList.add("disliked"),p.classList.remove("liked");const t=i.textContent;i.disabled=!0,i.textContent="...",B++,await E({previousColor:c,mode:"refine",step:B}),i.disabled=!1,i.textContent=t;return}e==="like"&&(await fetch(T,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:x,color:c,rating:e})}),p.classList.add("liked"),i.classList.remove("disliked"))}catch(t){console.error("Feedback failed:",t),i.disabled=!1,i.textContent="ðŸ‘Ž"}}function P(){if(!c)return;const e=`<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000">
  <rect width="1000" height="1000" fill="${c}" />
  <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="80" fill="${U(c)}" text-anchor="middle" dy=".3em">${c}</text>
</svg>`,t=new Blob([e],{type:"image/svg+xml"}),l=URL.createObjectURL(t),s=document.createElement("a");s.download=`swatch-${c.substring(1)}.svg`,s.href=l,s.click(),URL.revokeObjectURL(l)}function U(e){e=e.replace("#","");var t=parseInt(e.substr(0,2),16),l=parseInt(e.substr(2,2),16),s=parseInt(e.substr(4,2),16),n=(t*299+l*587+s*114)/1e3;return n>=128?"black":"white"}y.addEventListener("click",E);h.addEventListener("keypress",e=>{e.key==="Enter"&&E()});L.addEventListener("click",P);p.addEventListener("click",()=>F("like"));i.addEventListener("click",()=>F("dislike"));function I(e,t,l=!1){if(!f)return;f.textContent=e,f.classList.toggle("error",l);const s=12,n=240,o=60,r=window.innerWidth/2,a=24,m=typeof t?.clientX=="number"?t.clientX:r,u=typeof t?.clientY=="number"?t.clientY:a,d=Math.min(Math.max(8,m+s),window.innerWidth-n-8),k=Math.min(Math.max(8,u+s),window.innerHeight-o-8);f.style.left=`${d}px`,f.style.top=`${k}px`,f.style.display="block",f.classList.add("show"),w&&clearTimeout(w),w=setTimeout(()=>{f.classList.remove("show"),f.style.display="none"},2e3)}C.addEventListener("click",e=>{c&&navigator.clipboard.writeText(c).then(()=>{I("Copied to clipboard!",e,!1)}).catch(t=>{console.error("Failed to copy class",t),I("Failed to copy",e,!0)})});
