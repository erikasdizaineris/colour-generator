(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}})();const m=document.getElementById("colorInput"),p=document.getElementById("generateBtn"),g=document.getElementById("colorPreview"),h=document.getElementById("hexCode"),i=document.getElementById("similarBtn"),b=document.getElementById("downloadBtn");document.getElementById("canvas");const f=document.getElementById("toast"),B=[m,p,g,h,b];B.some(e=>!e)&&console.error("Missing required UI elements. Make sure the latest HTML is deployed.");const F="",w=F.replace(/\/+$/,""),O=w?`${w}/api/generate`:"/api/generate",S=w?`${w}/api/feedback`:"/api/feedback";let a="",C="",k=null;function T(e){return e?(e.startsWith("#"),e):"#FFFFFF"}let x=0;async function E(e={}){if(B.some(o=>!o))return;const t=m.value.trim();if(!t)return;const{previousColor:l,mode:r,step:n}=e;p.disabled=!0,p.textContent="Generating...",r||(x=0),r!=="refine"&&i&&(i.disabled=!0);try{const o=await fetch(O,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,previousColor:l,mode:r,step:n||0})});if(!o.ok)throw new Error("Generation failed");const s=await o.json();if(!s||typeof s.color!="string")throw new Error("No color in response");let c=T(s.color).toUpperCase();l&&c===l&&(console.warn("Server returned same color. Forcing client-side shift."),c="#"+((parseInt(c.slice(1),16)+3355443)%16777215).toString(16).padStart(6,"0").toUpperCase()),C=t,a=c,g.style.backgroundColor=c,g.classList.add("active"),h.textContent=c,b.disabled=!1,i&&(i.disabled=!1),m.style.borderColor=c}catch(o){console.warn("Backend unavailable:",o);let s=0;const c=t+(n||0);for(let d=0;d<c.length;d++)s=c.charCodeAt(d)+((s<<5)-s);let y="#";for(let d=0;d<3;d++){const v=s>>d*8&255;y+=("00"+v.toString(16)).substr(-2)}const u=y.toUpperCase();g.style.backgroundColor=u,g.classList.add("active"),h.textContent=u,a=u,b.disabled=!1,i&&(i.disabled=!1),m.style.borderColor=u}finally{p.disabled=!1,p.textContent="Generate"}}async function I(e){if(!(!C||!a))try{e==="like"&&await fetch(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:C,color:a,rating:e})})}catch(t){console.error("Feedback failed:",t)}}async function $(){if(!C||!a||!i)return;const e=i.textContent;i.disabled=!0,i.textContent="Generating...";try{x++,await E({previousColor:a,mode:"refine",step:x})}finally{i.disabled=!1,i.textContent=e}}function M(){if(!a)return;const e=`<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000">
  <rect width="1000" height="1000" fill="${a}" />
  <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="80" fill="${P(a)}" text-anchor="middle" dy=".3em">${a}</text>
</svg>`,t=new Blob([e],{type:"image/svg+xml"}),l=URL.createObjectURL(t),r=document.createElement("a");r.download=`swatch-${a.substring(1)}.svg`,r.href=l,r.click(),URL.revokeObjectURL(l)}function P(e){e=e.replace("#","");var t=parseInt(e.substr(0,2),16),l=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16),n=(t*299+l*587+r*114)/1e3;return n>=128?"black":"white"}p&&m&&(p.addEventListener("click",E),m.addEventListener("keypress",e=>{e.key==="Enter"&&E()}));b&&b.addEventListener("click",async()=>{await I("like"),M()});i&&i.addEventListener("click",$);function L(e,t,l=!1){if(!f)return;f.textContent=e,f.classList.toggle("error",l);const r=12,n=240,o=60,s=window.innerWidth/2,c=24,y=typeof t?.clientX=="number"?t.clientX:s,u=typeof t?.clientY=="number"?t.clientY:c,d=Math.min(Math.max(8,y+r),window.innerWidth-n-8),v=Math.min(Math.max(8,u+r),window.innerHeight-o-8);f.style.left=`${d}px`,f.style.top=`${v}px`,f.style.display="block",f.classList.add("show"),k&&clearTimeout(k),k=setTimeout(()=>{f.classList.remove("show"),f.style.display="none"},2e3)}h&&h.addEventListener("click",async e=>{if(a){try{await I("like")}catch(t){console.warn("Failed to send learning feedback on copy:",t)}navigator.clipboard.writeText(a).then(()=>{L("Copied to clipboard!",e,!1)}).catch(t=>{console.error("Failed to copy class",t),L("Failed to copy",e,!0)})}});
