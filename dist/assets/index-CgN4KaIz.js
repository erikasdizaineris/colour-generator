(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();const g=document.getElementById("colorInput"),m=document.getElementById("generateBtn"),y=document.getElementById("colorPreview"),v=document.getElementById("hexCode"),f=document.getElementById("similarBtn"),x=document.getElementById("downloadBtn");document.getElementById("canvas");const d=document.getElementById("toast"),L="",h=L.replace(/\/+$/,""),I=h?`${h}/api/generate`:"/api/generate",F=h?`${h}/api/feedback`:"/api/feedback";let i="",b="",C=null;function O(e){return e?(e.startsWith("#"),e):"#FFFFFF"}let k=0;async function E(e={}){const n=g.value.trim();if(!n)return;const{previousColor:a,mode:r,step:t}=e;m.disabled=!0,m.textContent="Generating...",r||(k=0),r!=="refine"&&(f.disabled=!0);try{const o=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n,previousColor:a,mode:r,step:t||0})});if(!o.ok)throw new Error("Generation failed");const s=await o.json();if(!s||typeof s.color!="string")throw new Error("No color in response");let l=O(s.color).toUpperCase();a&&l===a&&(console.warn("Server returned same color. Forcing client-side shift."),l="#"+((parseInt(l.slice(1),16)+3355443)%16777215).toString(16).padStart(6,"0").toUpperCase()),b=n,i=l,y.style.backgroundColor=l,y.classList.add("active"),v.textContent=l,x.disabled=!1,f.disabled=!1,g.style.borderColor=l}catch(o){console.warn("Backend unavailable:",o);let s=0;const l=n+(t||0);for(let c=0;c<l.length;c++)s=l.charCodeAt(c)+((s<<5)-s);let p="#";for(let c=0;c<3;c++){const w=s>>c*8&255;p+=("00"+w.toString(16)).substr(-2)}const u=p.toUpperCase();y.style.backgroundColor=u,y.classList.add("active"),v.textContent=u,i=u,x.disabled=!1,f.disabled=!1,g.style.borderColor=u}finally{m.disabled=!1,m.textContent="Generate"}}async function S(e){if(!(!b||!i))try{e==="like"&&await fetch(F,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:b,color:i,rating:e})})}catch(n){console.error("Feedback failed:",n)}}async function T(){if(!b||!i)return;const e=f.textContent;f.disabled=!0,f.textContent="Generating...";try{k++,await E({previousColor:i,mode:"refine",step:k})}finally{f.disabled=!1,f.textContent=e}}function $(){if(!i)return;const e=`<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000">
  <rect width="1000" height="1000" fill="${i}" />
  <text x="50%" y="50%" font-family="Arial, sans-serif" font-size="80" fill="${P(i)}" text-anchor="middle" dy=".3em">${i}</text>
</svg>`,n=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(n),r=document.createElement("a");r.download=`swatch-${i.substring(1)}.svg`,r.href=a,r.click(),URL.revokeObjectURL(a)}function P(e){e=e.replace("#","");var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16),t=(n*299+a*587+r*114)/1e3;return t>=128?"black":"white"}m.addEventListener("click",E);g.addEventListener("keypress",e=>{e.key==="Enter"&&E()});x.addEventListener("click",async()=>{await S("like"),$()});f.addEventListener("click",T);function B(e,n,a=!1){if(!d)return;d.textContent=e,d.classList.toggle("error",a);const r=12,t=240,o=60,s=window.innerWidth/2,l=24,p=typeof n?.clientX=="number"?n.clientX:s,u=typeof n?.clientY=="number"?n.clientY:l,c=Math.min(Math.max(8,p+r),window.innerWidth-t-8),w=Math.min(Math.max(8,u+r),window.innerHeight-o-8);d.style.left=`${c}px`,d.style.top=`${w}px`,d.style.display="block",d.classList.add("show"),C&&clearTimeout(C),C=setTimeout(()=>{d.classList.remove("show"),d.style.display="none"},2e3)}v.addEventListener("click",e=>{i&&navigator.clipboard.writeText(i).then(()=>{B("Copied to clipboard!",e,!1)}).catch(n=>{console.error("Failed to copy class",n),B("Failed to copy",e,!0)})});
